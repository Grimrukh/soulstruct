"""
Land of Shadow 12-11 SW SE

linked:
0
82

strings:
0: N:\\GR\\data\\Param\\event\\common_func.emevd
82: N:\\GR\\data\\Param\\event\\common_macro.emevd
166: 
168: 
170: 
172: 
174: 
"""
# [COMMON_FUNC]
from .common_func import *
from soulstruct.eldenring.events import *
from soulstruct.eldenring.events.instructions import *
from soulstruct.eldenring.game_types import *


@ContinueOnRest(0)
def Constructor():
    """Event 0"""
    RegisterGrace(grace_flag=2049440000, asset=2049441950)
    RegisterGrace(grace_flag=2049440001, asset=2049441951)
    Event_2049442800()
    Event_2049442801()
    Event_2049442802()
    CommonFunc_90005221(0, character=2049440213, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440217, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440221, animation_id=30005, animation_id_1=20005, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440223, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440225, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440226, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440227, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440228, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440229, animation_id=30005, animation_id_1=20005, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440230, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440233, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440234, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440235, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440236, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440237, animation_id=30005, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440238, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440239, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440240, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440241, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440242, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440243, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440244, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440245, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440246, animation_id=30001, animation_id_1=20001, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440247, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440248, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440249, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440250, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440251, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440252, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440253, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440254, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440256, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440257, animation_id=30000, animation_id_1=20000, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440262, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440285, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440286, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440287, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440288, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440289, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    CommonFunc_90005221(0, character=2049440290, animation_id=30002, animation_id_1=20002, seconds=0.0, left=0)
    Event_2049442580()
    CommonFunc_90005638(0, flag=2049440600, asset=2049441600, asset_1=2049441601)
    CommonFunc_900005580(0, flag=580600, asset=2049441500, flag_1=9146)
    Event_2049440701(
        0,
        character=2049440700,
        flag=4560,
        flag_1=4563,
        flag_2=4565,
        animation_id=90100,
        flag_3=4909,
        flag_4=2049442703,
        flag_5=2049442700,
        flag_6=2049442810,
    )
    Event_2049440700(0, entity=2049440700, flag=2049449210)
    Event_2049440702(0, flag=2049440800, flag_1=2049449211, flag_2=4909)
    Event_2049440703(0, flag=2049449211, flag_1=2049442703, flag_2=4909)
    Event_2049440704(0, flag=2049442702, flag_1=2049449200, flag_2=4909, flag_3=2049449205)
    CommonFunc_90005749(0, character=2049440701, character_1=2049440700, flag=4565, flag_1=2049442700)
    CommonFunc_90005750(
        0,
        asset=2049441730,
        action_button_id=4350,
        item_lot=107300,
        first_flag=400730,
        last_flag=400730,
        flag=2049449211,
        vfx_id=6102,
    )
    Event_2049440705(
        0,
        entity=2049441740,
        action_button_id=206023,
        text=1030052,
        display_distance=30.0,
        flag=4922,
        flag_1=2049442810,
    )
    Event_2049440706(0, entity=2049440700, flag=2049442708, flag_1=4565, flag_2=4909)


@RestartOnRest(2049442800)
def Event_2049442800():
    """Event 2049442800"""
    if FlagEnabled(2049440800):
        return
    if PlayerNotInOwnWorld():
        return
    AND_1.Add(CharacterDead(2049440710))
    AND_1.Add(FlagEnabled(2049442810))
    
    MAIN.Await(AND_1)
    
    Wait(3.0)
    KillBossAndDisplayBanner(character=2049440710, banner_type=BannerType.EnemyFelled)
    DeactivateGparamOverride(change_duration=10.0)
    EnableNetworkFlag(2049440800)
    Wait(5.0)
    AddSpecialEffect(ALL_PLAYERS, 8870)
    Wait(2.0)
    DisableFlag(2049442810)
    WarpToMap(game_map=LANDOFSHADOW_12_11_SW_SE, player_start=2049442721, unk_8_12=61494400)
    End()


@RestartOnRest(2049442801)
def Event_2049442801():
    """Event 2049442801"""
    if PlayerNotInOwnWorld():
        return
    if FlagEnabled(2049440800):
        return
    if FlagEnabled(2049440801):
        return
    AND_2.Add(MultiplayerPending())
    AND_1.Add(not AND_2)
    AND_1.Add(Singleplayer())
    AND_1.Add(FlagEnabled(2049442702))
    
    MAIN.Await(AND_1)
    
    OR_3.Add(Multiplayer())
    OR_3.Add(MultiplayerPending())
    if OR_3:
        return RESTART
    AddSpecialEffect(PLAYER, 514)
    Wait(1.5)
    EnableNetworkFlag(2049440801)
    MoveCharacterAndCopyDrawParentWithFadeout(
        character=PLAYER,
        destination_type=CoordEntityType.Region,
        destination=2049442720,
        dummy_id=-1,
        copy_draw_parent=PLAYER,
        use_bonfire_effect=True,
        reset_camera=True,
    )
    End()


@RestartOnRest(2049442802)
def Event_2049442802():
    """Event 2049442802"""
    GotoIfFlagDisabled(Label.L0, flag=2049440800)
    DisableCharacter(2049440710)
    DisableAnimations(2049440710)
    Kill(2049440710)
    DisableAsset(2049441720)
    End()

    # --- Label 0 --- #
    DefineLabel(0)
    DisableCharacter(2049440710)
    DisableAnimations(2049440710)
    DisableAI(2049440710)
    DisableAsset(2049441720)
    if FlagDisabled(2049440801):
        return
    if PlayerNotInOwnWorld():
        return
    WaitFrames(frames=1)
    SetCameraAngle(x_angle=27.520000457763672, y_angle=-55.20000076293945)
    DisableCharacter(2049445810)
    EnableFlag(2049442810)
    AddSpecialEffect(PLAYER, 190)
    ActivateGparamOverride(gparam_sub_id=0, change_duration=0.0)
    SetWeather(weather=Weather.PuffyClouds, duration=-1.0, immediate_change=False)
    DisableCharacter(2049445800)
    DisableAnimations(2049445800)
    DisableAI(2049445800)
    DisableHealthBar(2049440710)
    DisableNetworkFlag(2049440801)
    AddSpecialEffect(PLAYER, 514)
    EnableAsset(2049441720)
    MoveAssetToCharacter(2049441720, character=2049441801, dummy_id=100)
    CreateAssetVFX(2049441720, dummy_id=200, vfx_id=806700)
    EnableCharacter(2049440710)
    Move(2049440710, destination=2049442822, destination_type=CoordEntityType.Region, short_move=True)
    EnableAnimations(2049440710)
    OR_1.Add(EntityWithinDistance(entity=PLAYER, other_entity=2049440710, radius=10.0))
    OR_1.Add(TimeElapsed(seconds=5.0))
    OR_1.Add(AttackedWithDamageType(attacked_entity=2049440710, attacker=PLAYER))
    OR_1.Add(AttackedWithDamageType(attacked_entity=2049440710))
    
    MAIN.Await(OR_1)
    
    DisableFlag(1099002100)
    EnableAI(2049440710)
    SetNetworkUpdateRate(2049440710, is_fixed=True, update_rate=CharacterUpdateRate.Always)
    EnableFlag(2049442805)
    Wait(1.0)
    EnableBossHealthBar(2049440710, name=142501)


@RestartOnRest(2049442805)
def Event_2049442805():
    """Event 2049442805"""
    DisableNetworkSync()
    GotoIfFlagDisabled(Label.L0, flag=2049440800)
    End()

    # --- Label 0 --- #
    DefineLabel(0)
    AND_1.Add(FlagEnabled(2049442805))
    
    MAIN.Await(AND_1)
    
    WaitFrames(frames=1)
    OR_2.Add(FlagEnabled(2049442802))
    OR_2.Add(FlagEnabled(2049440800))
    
    MAIN.Await(OR_2)
    
    GotoIfFlagEnabled(Label.L1, flag=2049440800)
    WaitFrames(frames=1)
    OR_3.Add(FlagEnabled(2049440800))
    
    MAIN.Await(OR_3)

    # --- Label 1 --- #
    DefineLabel(1)
    SetBossMusic(bgm_boss_conv_param_id=925000, state=BossMusicState.NormalFadeOut)


@ContinueOnRest(2049442580)
def Event_2049442580():
    """Event 2049442580"""
    RegisterLadder(start_climbing_flag=2049440580, stop_climbing_flag=2049440581, asset=2049441580)


@RestartOnRest(2049440700)
def Event_2049440700(_, entity: uint, flag: Flag | int):
    """Event 2049440700"""
    if PlayerNotInOwnWorld():
        return
    if FlagEnabled(flag):
        return
    AND_1.Add(EntityWithinDistance(entity=entity, other_entity=PLAYER, radius=7.0))
    
    MAIN.Await(AND_1)
    
    EnableFlag(flag)
    End()


@RestartOnRest(2049440701)
def Event_2049440701(
    _,
    character: uint,
    flag: Flag | int,
    flag_1: Flag | int,
    flag_2: Flag | int,
    animation_id: int,
    flag_3: Flag | int,
    flag_4: Flag | int,
    flag_5: Flag | int,
    flag_6: Flag | int,
):
    """Event 2049440701"""
    DisableNetworkSync()
    WaitFrames(frames=1)
    WaitFrames(frames=1)
    GotoIfPlayerNotInOwnWorld(Label.L10)

    # --- Label 10 --- #
    DefineLabel(10)
    DisableCharacter(character)
    DisableBackread(character)
    AND_1.Add(FlagEnabled(flag_2))
    AND_1.Add(FlagDisabled(flag_3))
    AND_1.Add(FlagDisabled(flag_4))
    GotoIfConditionTrue(Label.L0, input_condition=AND_1)
    AND_2.Add(FlagEnabled(flag_2))
    AND_2.Add(FlagDisabled(flag_3))
    AND_2.Add(FlagDisabled(flag_4))
    
    MAIN.Await(AND_2)
    
    Restart()

    # --- Label 0 --- #
    DefineLabel(0)
    GotoIfFlagEnabled(Label.L1, flag=flag)
    GotoIfFlagEnabled(Label.L4, flag=flag_1)
    Goto(Label.L20)

    # --- Label 1 --- #
    DefineLabel(1)
    SkipLinesIfFlagEnabled(7, flag_6)
    SkipLinesIfFlagEnabled(6, flag_5)
    EnableCharacter(character)
    EnableBackread(character)
    
    MAIN.Await(CharacterBackreadEnabled(character))
    
    ResetCharacterPosition(character=character)
    SetTeamType(character, TeamType.NoTeam)
    ForceAnimation(character, animation_id, loop=True)
    WaitRealFrames(frames=1)
    Goto(Label.L20)

    # --- Label 4 --- #
    DefineLabel(4)
    Goto(Label.L20)

    # --- Label 20 --- #
    DefineLabel(20)
    AND_3.Add(FlagEnabled(flag_2))
    AND_3.Add(FlagDisabled(flag_3))
    AND_3.Add(FlagDisabled(flag_4))
    
    MAIN.Await(not AND_3)
    
    Restart()


@RestartOnRest(2049440702)
def Event_2049440702(_, flag: Flag | int, flag_1: Flag | int, flag_2: Flag | int):
    """Event 2049440702"""
    if PlayerNotInOwnWorld():
        return
    if FlagEnabled(flag_1):
        return
    if FlagEnabled(flag_2):
        return
    if FlagEnabled(flag):
        EnableFlag(flag_1)
    End()


@RestartOnRest(2049440703)
def Event_2049440703(_, flag: Flag | int, flag_1: Flag | int, flag_2: Flag | int):
    """Event 2049440703"""
    if PlayerNotInOwnWorld():
        return
    if FlagEnabled(flag_2):
        return
    WaitFrames(frames=1)
    if FlagEnabled(flag):
        EnableFlag(flag_1)
    End()


@RestartOnRest(2049440704)
def Event_2049440704(_, flag: Flag | int, flag_1: Flag | int, flag_2: Flag | int, flag_3: Flag | int):
    """Event 2049440704"""
    if PlayerNotInOwnWorld():
        return
    if FlagEnabled(flag_2):
        return
    AwaitFlagEnabled(flag=flag)
    OR_1.Add(Multiplayer())
    OR_1.Add(MultiplayerPending())
    GotoIfConditionTrue(Label.L0, input_condition=OR_1)
    End()

    # --- Label 0 --- #
    DefineLabel(0)
    EnableFlag(flag)
    if FlagDisabled(flag_1):
        EnableFlag(flag_3)
    End()


@RestartOnRest(2049440705)
def Event_2049440705(
    _,
    entity: uint,
    action_button_id: int,
    text: EventText | int,
    display_distance: float,
    flag: Flag | int,
    flag_1: Flag | int,
):
    """Event 2049440705"""
    if PlayerNotInOwnWorld():
        return
    WaitFrames(frames=2)
    if FlagEnabled(flag_1):
        return
    
    MAIN.Await(ActionButtonParamActivated(action_button_id=action_button_id, entity=entity))
    
    DisplayDialog(text=text, display_distance=display_distance, button_type=ButtonType.Yes_or_No)
    EnableFlag(flag)
    Wait(1.0)
    Restart()


@RestartOnRest(2049440706)
def Event_2049440706(_, entity: uint, flag: Flag | int, flag_1: Flag | int, flag_2: Flag | int):
    """Event 2049440706"""
    DisableNetworkSync()
    if PlayerNotInOwnWorld():
        return
    AND_10.Add(FlagEnabled(flag_1))
    
    MAIN.Await(AND_10)
    
    WaitRealFrames(frames=1)
    if FlagEnabled(flag_2):
        return
    GotoIfFlagDisabled(Label.L1, flag=flag)
    Goto(Label.L2)

    # --- Label 1 --- #
    DefineLabel(1)
    AND_1.Add(EntityWithinDistance(entity=entity, other_entity=PLAYER, radius=2.5999999046325684))
    
    MAIN.Await(AND_1)
    
    EnableFlag(flag)
    Restart()

    # --- Label 2 --- #
    DefineLabel(2)
    AND_2.Add(EntityBeyondDistance(entity=entity, other_entity=PLAYER, radius=2.5999999046325684))
    
    MAIN.Await(AND_2)
    
    DisableFlag(flag)
    Restart()
